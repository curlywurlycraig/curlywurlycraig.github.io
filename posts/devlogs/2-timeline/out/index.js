(()=>{var B=class{tokens=[];raw="";idx=0;constructor(r){this.raw=r}isAtEnd(){return this.idx>=this.raw.length}},j=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9",dt=e=>e>="0"&&e<="9",ct=e=>e===`
`||e===" "||e==="	",ut=e=>r=>{let n=r.idx;for(;!e(r);){if(r.isAtEnd())return r.idx=n,null;r.idx++}let t=r.idx;return r.idx=n,{start:n,end:t}},lt=()=>e=>e.isAtEnd()?{start:e.idx,end:e.idx}:null,C=e=>r=>{let n=r.idx,t=n;for(;e(r.raw[t])&&r.raw[t]!==void 0;)t++;if(t>n)return{start:n,end:t}},R=e=>r=>e(r)||{start:r.idx,end:r.idx},ft=C(j),K=C(dt),X=e=>r=>{if(e(r.raw[r.idx]))return{start:r.idx,end:r.idx+1}},It=X(ct),E=e=>X(r=>r===e),k=X(e=>!j(e)),U=e=>{let r=[];for(let n=0;n<e.length;n++)r.push(E(e[n]));return p(...r)},p=(...e)=>r=>{let n=r.idx,t=0;for(let o=0;o<e.length;o++){let i=e[o](r);if(!i)return r.idx=n,null;r.idx+=i.end-i.start,t+=i.end-i.start}return r.idx=n,{start:r.idx,end:r.idx+t}},ht=e=>r=>{let n=r.idx,t=e(r);if(t)return r.idx+=t.end-t.start,{start:n,end:n}},D=(e,r)=>n=>{let t=e(n);if(t)return t.type=r,t.parser=e,n.tokens.push(t),n.idx=t.end,t},pt=e=>r=>{for(;r.raw[r.idx]!==void 0;)e(r)},S=(...e)=>r=>{for(let n=0;n<e.length;n++){let t=e[n](r);if(t)return t}},$=e=>r=>{let n=e(r);if(n)return{...n,end:n.start}},mt=(e,r=1)=>n=>{let t=n.idx;if(n.idx=n.idx-r,!e(n)){n.idx=t;return}return n.idx=t,{start:t,end:t}},gt=()=>e=>({start:e.idx,end:e.idx+1}),wt=p(ft,$(E("("))),Mt=S(p(U("//"),R(C(e=>e!==`
`))),p(U("/*"),ut(S(U("*/"),lt())),R(U("*/")))),xt=S(p(E('"'),R(C(e=>e!=='"')),E('"')),p(E("'"),R(C(e=>e!=="'")),E("'"))),Tt=p(K,R(E(".")),R(K)),_t=e=>e.idx===0?{start:0,end:0}:null,Et=e=>e.idx===e.raw.length?{start:e.idx,end:e.idx}:null,q=e=>p(S(_t,mt(k)),U(e),$(S(Et,k))),Z=pt(S(D(xt,"STRING"),D(Tt,"NUMBER"),D(q("null"),"KEYWORD"),D(q("undefined"),"KEYWORD"),ht(gt())));var L=class extends Array{},F="function";function O(e){return e instanceof L}var A=(e,r,...n)=>{let t=n.reduce((o,i)=>(Array.isArray(i)&&!O(i)?o.push(...i):o.push(i),o),[]);return new L(e,r||{},t)},z=(e,r="__r")=>{if(!O(e))return e;let[n,t,o]=e;t.key=t.key||r;let i=o.map((s,f)=>z(s,r+"c"+(s?.[1]?.key||f)));if(typeof n===F){let s=n({...t,children:i});return z(s,r+"e"+(s?.key||""))}return new L(n,t,i)},At=(e,r)=>{let[,n]=e._hic||[];return Object.entries(r).forEach(([t,o])=>{if(n&&typeof n[t]===F&&e.removeEventListener(t,n[t]),typeof o===F)e.addEventListener(t.toLowerCase(),o);else{if(t==="value"||t==="disabled"){e[t]=o;return}let i=e;i.getAttribute(t)!==o&&i.setAttribute(t,o)}}),e},vt=(e,r)=>{for(let n=r.length-1;n>=0;n--){let t=r[n],o=r[n+1]||null,i=t.nextSibling;(o!==i||!e.contains(t))&&e?.insertBefore(t,o)}for(;e.childNodes.length>r.length;)e?.removeChild(e.childNodes[0]);return e},G=(e,r)=>{let n=r;if(!e&&e!=="")return null;if(!O(e))return r?.nodeType!==3?document.createTextNode(e):(r.textContent!==e&&(r.textContent=e),r);let[t,o]=r?._hic||[],[i,s]=e;if(t!==i||!n){let c=s.xmlns||(i==="svg"?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml");n=document.createElementNS(c,i)}At(n,s),n._hic=e;let l=(O(e)?e[2]:[]).filter(c=>c).map((c,h)=>{let m=r?.childNodes[h];return G(c,m)});return vt(n,l),r!==n&&r?.parentNode?.replaceChild(n,r),typeof s.ref===F&&s.ref!==o?.ref&&s.ref(n,s.key),n};function W(e,r,n){var t=e.createShader(r);e.shaderSource(t,n),e.compileShader(t);var o=e.getShaderParameter(t,e.COMPILE_STATUS);if(o)return t;console.log(e.getShaderInfoLog(t)),e.deleteShader(t)}function Q(e,r,n){var t=e.createProgram();e.attachShader(t,r),e.attachShader(t,n),e.linkProgram(t);var o=e.getProgramParameter(t,e.LINK_STATUS);if(o)return t;console.log(e.getProgramInfoLog(t)),e.deleteProgram(t)}function tt(e,r=!0){let n=e.clientWidth,t=e.clientHeight,o=r?n*2:n,i=r?t*2:t,s=e.width!==o||e.height!==i;return s&&(e.width=o,e.height=i),s}function Y(e,r){return[1,0,0,0,1,0,e,r,1]}function et(e){let r=Math.cos(e),n=Math.sin(e);return[r,-n,0,n,r,0,0,0,1]}function rt(e,r){return[e,0,0,0,r,0,0,0,1]}function H(e,r){var n=e[0],t=e[0*3+1],o=e[0*3+2],i=e[1*3+0],s=e[1*3+1],f=e[1*3+2],l=e[2*3+0],c=e[2*3+1],h=e[2*3+2],m=r[0*3+0],b=r[0*3+1],I=r[0*3+2],v=r[1*3+0],u=r[1*3+1],g=r[1*3+2],y=r[2*3+0],w=r[2*3+1],M=r[2*3+2];return[m*n+b*i+I*l,m*t+b*s+I*c,m*o+b*f+I*h,v*n+u*i+g*l,v*t+u*s+g*c,v*o+u*f+g*h,y*n+w*i+M*l,y*t+w*s+M*c,y*o+w*f+M*h]}function N(e,r,n){return e*(1-n)+r*n}var Rt=[0,0,100,0,0,100,100,0,100,100,0,100],nt=[50,50],St=({value:e})=>A("pre",{class:"editor_draw"},A("code",null,(()=>{let n=new B(e);return parseResult=Z(n),n.tokens.length===0?[e]:n.tokens.reduce((t,o,i,s)=>{let l=s[i-1]?.end||0;o.start>l&&t.push(e.slice(l,o.start));let c=`parsed_${o.type}`,h=e.slice(o.start,o.end);return t.push(A("span",{class:c},h)),i===s.length-1&&t.push(e.slice(o.end)),t},[])})()));function bt(){let e=`#version 300 es

        in vec2 a_texcoord;
        in vec2 a_position;
        uniform vec2 u_resolution;
        uniform mat3 u_transform;

        out vec2 v_texcoord;

        void main() {
            vec2 position = (u_transform * vec3(a_position, 1)).xy;

            // convert the position from pixels to 0.0 to 1.0
            vec2 zeroToOne = position / u_resolution;

            // convert from 0->1 to 0->2
            vec2 zeroToTwo = zeroToOne * 2.0;

            vec2 clipSpace = zeroToTwo - 1.0;
            
            gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
            v_texcoord = a_texcoord;
        }
    `,r=`#version 300 es
        precision highp float;
        
        in vec2 v_texcoord;
        out vec4 outColor;
        uniform float u_brightness;
        uniform int u_sprite_idx;
        uniform int u_sprite_count;
        uniform sampler2D u_texture;

        void main() {
            vec2 frame_texcoord = v_texcoord +
                vec2(float(u_sprite_idx) / float(u_sprite_count), 0);

            vec4 textureColor = texture(u_texture, frame_texcoord);
            vec4 brightenedColor = textureColor + u_brightness * vec4(1.0, 1.0, 1.0, 0.0);
            outColor = vec4(brightenedColor.rgb, textureColor.a);
        }
    `,n=document.getElementById("example-timeline-ships"),t=n.getContext("webgl2");t||console.error("Failed to init webgl."),t.disable(t.DEPTH_TEST),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND);let o=W(t,t.VERTEX_SHADER,e),i=W(t,t.FRAGMENT_SHADER,r),s=Q(t,o,i),f=t.getAttribLocation(s,"a_position"),l=t.getAttribLocation(s,"a_texcoord"),c=t.getUniformLocation(s,"u_resolution"),h=t.getUniformLocation(s,"u_brightness"),m=t.getUniformLocation(s,"u_transform"),b=t.getUniformLocation(s,"u_sprite_idx"),I=t.getUniformLocation(s,"u_sprite_count"),v=t.createVertexArray();t.bindVertexArray(v);{let d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array(Rt),t.STATIC_DRAW),t.enableVertexAttribArray(f);let a=2,x=t.FLOAT,T=!1,_=0,P=0;t.vertexAttribPointer(f,a,x,T,_,P)}{let d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,.5,0,0,1,.5,0,.5,1,0,1]),t.STATIC_DRAW),t.enableVertexAttribArray(l);let a=2,x=t.FLOAT,T=!1,_=0,P=0;t.vertexAttribPointer(l,a,x,T,_,P)}{let d=t.createTexture();t.bindTexture(t.TEXTURE_2D,d),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));let a=new Image;a.src="resources/ship2.png",a.addEventListener("load",()=>{t.bindTexture(t.TEXTURE_2D,d),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),t.generateMipmap(t.TEXTURE_2D)})}tt(n,!0);let u={frameIdx:0,ship:{x:200,y:200,brightness:0,rotation:0,health:100,frame:0}},g=[{x:100,y:300,health:100,rotation:3*Math.PI/2},{x:100,y:300,health:100,rotation:3*Math.PI/2},{x:100,y:300,health:100,rotation:3*Math.PI/2},{x:200,y:300,health:100,rotation:3.5*Math.PI/2},{x:300,y:250,health:50,rotation:2*Math.PI},{x:400,y:200,health:50,rotation:2*Math.PI+Math.PI/4},{x:500,y:180,health:20,rotation:2*Math.PI+2*Math.PI/4},{x:600,y:150,health:20,rotation:2*Math.PI+3*Math.PI/4},{x:600,y:150,health:20,rotation:2*Math.PI+3*Math.PI/4},{x:600,y:150,health:20,rotation:2*Math.PI+3*Math.PI/4}];function y(){let d=g.map((x,T)=>{let _=`opacity: ${T===u.frameIdx?1:.5};`;return A("div",{class:"timeline-row",style:_},A(St,{value:JSON.stringify(x)}))});G(z(A("div",{id:"timeline-controls"},d)),document.getElementById("timeline-controls"))}y();function w(){t.viewport(0,0,n.width,n.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(s),t.bindVertexArray(v),t.uniform2f(c,n.width,n.height);let{brightness:d,x:a,y:x,rotation:T,frame:_}=u.ship,P=Y(a,x),ot=et(T),it=rt(1,1),st=Y(-nt[0],-nt[1]),at=H(P,H(ot,H(it,st)));t.uniform1i(b,_),t.uniform1i(I,2),t.uniform1f(h,d),t.uniformMatrix3fv(m,!1,at),t.drawArrays(t.TRIANGLES,0,6)}function M(){let d=g[u.frameIdx],a=u.ship;a.x=N(a.x,d.x,.1),a.y=N(a.y,d.y,.1),a.health=N(a.health,d.health,.1),a.rotation=N(a.rotation,d.rotation,.1),a.health>d.health?a.brightness=1-d.health/a.health:a.brightness=0}let V=0,J=0;window.requestAnimationFrame(function d(a){a-V>200&&(u.frameIdx=(u.frameIdx+1)%g.length,V=a,y()),a-J>200&&(u.ship.frame=(u.ship.frame+1)%2,J=a),M(),w(),window.requestAnimationFrame(d)})}window.onload=function(){bt()};})();
