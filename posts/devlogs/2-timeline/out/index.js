(()=>{var w=class{tokens=[];raw="";idx=0;constructor(r){this.raw=r}isAtEnd(){return this.idx>=this.raw.length}},O=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9",k=t=>t>="0"&&t<="9",q=t=>t===`
`||t===" "||t==="	",Z=t=>r=>{let n=r.idx;for(;!t(r);){if(r.isAtEnd())return r.idx=n,null;r.idx++}let e=r.idx;return r.idx=n,{start:n,end:e}},$=()=>t=>t.isAtEnd()?{start:t.idx,end:t.idx}:null,y=t=>r=>{let n=r.idx,e=n;for(;t(r.raw[e])&&r.raw[e]!==void 0;)e++;if(e>n)return{start:n,end:e}},m=t=>r=>t(r)||{start:r.idx,end:r.idx},Q=y(O),P=y(k),M=t=>r=>{if(t(r.raw[r.idx]))return{start:r.idx,end:r.idx+1}},ge=M(q),l=t=>M(r=>r===t),B=M(t=>!O(t)),v=t=>{let r=[];for(let n=0;n<t.length;n++)r.push(l(t[n]));return u(...r)},u=(...t)=>r=>{let n=r.idx,e=0;for(let o=0;o<t.length;o++){let i=t[o](r);if(!i)return r.idx=n,null;r.idx+=i.end-i.start,e+=i.end-i.start}return r.idx=n,{start:r.idx,end:r.idx+e}},ee=t=>r=>{let n=r.idx,e=t(r);if(e)return r.idx+=e.end-e.start,{start:n,end:n}},b=(t,r)=>n=>{let e=t(n);if(e)return e.type=r,e.parser=t,n.tokens.push(e),n.idx=e.end,e},te=t=>r=>{for(;r.raw[r.idx]!==void 0;)t(r)},g=(...t)=>r=>{for(let n=0;n<t.length;n++){let e=t[n](r);if(e)return e}},z=t=>r=>{let n=t(r);if(n)return{...n,end:n.start}},re=(t,r=1)=>n=>{let e=n.idx;if(n.idx=n.idx-r,!t(n)){n.idx=e;return}return n.idx=e,{start:e,end:e}},ne=()=>t=>({start:t.idx,end:t.idx+1}),xe=u(Q,z(l("("))),Te=g(u(v("//"),m(y(t=>t!==`
`))),u(v("/*"),Z(g(v("*/"),$())),m(v("*/")))),oe=g(u(l('"'),m(y(t=>t!=='"')),l('"')),u(l("'"),m(y(t=>t!=="'")),l("'"))),ie=u(P,m(l(".")),m(P)),se=t=>t.idx===0?{start:0,end:0}:null,ae=t=>t.idx===t.raw.length?{start:t.idx,end:t.idx}:null,F=t=>u(g(se,re(B)),v(t),z(g(ae,B))),H=te(g(b(oe,"STRING"),b(ie,"NUMBER"),b(F("null"),"KEYWORD"),b(F("undefined"),"KEYWORD"),ee(ne())));var R=class extends Array{},N="function";function C(t){return t instanceof R}var p=(t,r,...n)=>{let e=n.reduce((o,i)=>(Array.isArray(i)&&!C(i)?o.push(...i):o.push(i),o),[]);return new R(t,r||{},e)},U=(t,r="__r")=>{if(!C(t))return t;let[n,e,o]=t;e.key=e.key||r;let i=o.map((s,f)=>U(s,r+"c"+(s?.[1]?.key||f)));if(typeof n===N){let s=n({...e,children:i});return U(s,r+"e"+(s?.key||""))}return new R(n,e,i)},de=(t,r)=>{let[,n]=t._hic||[];return Object.entries(r).forEach(([e,o])=>{if(n&&typeof n[e]===N&&t.removeEventListener(e,n[e]),typeof o===N)t.addEventListener(e.toLowerCase(),o);else{if(e==="value"||e==="disabled"){t[e]=o;return}let i=t;i.getAttribute(e)!==o&&i.setAttribute(e,o)}}),t},ce=(t,r)=>{for(let n=r.length-1;n>=0;n--){let e=r[n],o=r[n+1]||null,i=e.nextSibling;(o!==i||!t.contains(e))&&t?.insertBefore(e,o)}for(;t.childNodes.length>r.length;)t?.removeChild(t.childNodes[0]);return t},D=(t,r)=>{let n=r;if(!t&&t!=="")return null;if(!C(t))return r?.nodeType!==3?document.createTextNode(t):(r.textContent!==t&&(r.textContent=t),r);let[e,o]=r?._hic||[],[i,s]=t;if(e!==i||!n){let c=s.xmlns||(i==="svg"?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml");n=document.createElementNS(c,i)}de(n,s),n._hic=t;let h=(C(t)?t[2]:[]).filter(c=>c).map((c,x)=>{let S=r?.childNodes[x];return D(c,S)});return ce(n,h),r!==n&&r?.parentNode?.replaceChild(n,r),typeof s.ref===N&&s.ref!==o?.ref&&s.ref(n,s.key),n};function I(t,r,n){var e=t.createShader(r);t.shaderSource(e,n),t.compileShader(e);var o=t.getShaderParameter(e,t.COMPILE_STATUS);if(o)return e;console.log(t.getShaderInfoLog(e)),t.deleteShader(e)}function X(t,r,n){var e=t.createProgram();t.attachShader(e,r),t.attachShader(e,n),t.linkProgram(e);var o=t.getProgramParameter(e,t.LINK_STATUS);if(o)return e;console.log(t.getProgramInfoLog(e)),t.deleteProgram(e)}function G(t,r=!0){let n=t.clientWidth,e=t.clientHeight,o=r?n*2:n,i=r?e*2:e,s=t.width!==o||t.height!==i;return s&&(t.width=o,t.height=i),s}var ue=[0,0,100,0,0,100,100,0,100,100,0,100],W=[50,50],le=({value:t})=>p("pre",{class:"editor_draw"},p("code",null,(()=>{let n=new w(t);return parseResult=H(n),n.tokens.length===0?[t]:n.tokens.reduce((e,o,i,s)=>{let h=s[i-1]?.end||0;o.start>h&&e.push(t.slice(h,o.start));let c=`parsed_${o.type}`,x=t.slice(o.start,o.end);return e.push(p("span",{class:c},x)),i===s.length-1&&e.push(t.slice(o.end)),e},[])})()));function pe(){let t=`#version 300 es

        in vec2 a_texcoord;
        in vec2 a_position;
        uniform vec2 u_resolution;
        uniform mat3 u_transform;

        out vec2 v_texcoord;

        void main() {
            vec2 position = (u_transform * vec3(a_position, 1)).xy;

            // convert the position from pixels to 0.0 to 1.0
            vec2 zeroToOne = position / u_resolution;

            // convert from 0->1 to 0->2
            vec2 zeroToTwo = zeroToOne * 2.0;

            vec2 clipSpace = zeroToTwo - 1.0;
            
            gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
            v_texcoord = a_texcoord;
        }
    `,r=`#version 300 es
        precision highp float;
        
        in vec2 v_texcoord;
        out vec4 outColor;
        uniform float u_brightness;
        uniform sampler2D u_texture;

        void main() {
            vec4 textureColor = texture(u_texture, v_texcoord);
            vec4 brightenedColor = textureColor + u_brightness * vec4(1.0, 1.0, 1.0, 0.0);
            outColor = vec4(brightenedColor.rgb, textureColor.a);
        }
    `,n=document.getElementById("example-timeline-ships"),e=n.getContext("webgl2");e||console.error("Failed to init webgl."),e.disable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND);let o=I(e,e.VERTEX_SHADER,t),i=I(e,e.FRAGMENT_SHADER,r),s=X(e,o,i),f=e.getAttribLocation(s,"a_position"),h=e.getUniformLocation(s,"u_resolution"),c=e.getUniformLocation(s,"u_brightness"),x=e.getUniformLocation(s,"u_transform"),S=e.getAttribLocation(s,"a_texcoord"),L=e.createVertexArray();e.bindVertexArray(L);{let d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,new Float32Array(ue),e.STATIC_DRAW),e.enableVertexAttribArray(f);let a=2,T=e.FLOAT,E=!1,_=0,A=0;e.vertexAttribPointer(f,a,T,E,_,A)}{let d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,.5,0,0,1,.5,0,.5,1,0,1]),e.STATIC_DRAW),e.enableVertexAttribArray(S);let a=2,T=e.FLOAT,E=!1,_=0,A=0;e.vertexAttribPointer(S,a,T,E,_,A)}{let d=e.createTexture();e.bindTexture(e.TEXTURE_2D,d),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));let a=new Image;a.src="resources/ship2.png",a.addEventListener("load",()=>{e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.generateMipmap(e.TEXTURE_2D)})}G(n,!0);let fe={frameIdx:0,ship:{x:200,y:200,brightness:0,rotation:0,health:100}},Y=[{x:200,y:200,health:100,rotation:0},{x:100,y:100,health:50,rotation:Math.PI}];function V(){let d=Y.map(a=>p("div",{class:"timeline-row"},p(le,{value:JSON.stringify(a)})));D(U(p("div",{id:"timeline-controls"},d)),document.getElementById("timeline-controls"))}V();function he(){e.viewport(0,0,n.width,n.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(s),e.bindVertexArray(L),e.uniform2f(h,n.width,n.height);let{brightness:d,x:a,y:T,rotation:E}=ship,_=translationMatrix(a,T),A=rotationMatrix(E),J=scaleMatrix(1,1),K=translationMatrix(-W[0],-W[1]),j=multiplyMatrix(_,multiplyMatrix(A,multiplyMatrix(J,K)));e.uniform1f(c,d),e.uniformMatrix3fv(x,!1,j),e.drawArrays(e.TRIANGLES,0,6)}function me(){ship.x=lerp(ship.x,shipTarget.x,.1),ship.y=lerp(ship.y,shipTarget.y,.1),ship.health=lerp(ship.health,shipTarget.health,.5),ship.rotation=lerp(ship.rotation,shipTarget.rotation,.1),ship.health>shipTarget.health?ship.brightness=1-shipTarget.health/ship.health:ship.brightness=0}}window.onload=function(){pe()};})();
