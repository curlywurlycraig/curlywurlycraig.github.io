(()=>{var P=class{tokens=[];raw="";idx=0;constructor(r){this.raw=r}isAtEnd(){return this.idx>=this.raw.length}},K=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9",oe=t=>t>="0"&&t<="9",ie=t=>t===`
`||t===" "||t==="	",se=t=>r=>{let n=r.idx;for(;!t(r);){if(r.isAtEnd())return r.idx=n,null;r.idx++}let e=r.idx;return r.idx=n,{start:n,end:e}},ae=()=>t=>t.isAtEnd()?{start:t.idx,end:t.idx}:null,U=t=>r=>{let n=r.idx,e=n;for(;t(r.raw[e])&&r.raw[e]!==void 0;)e++;if(e>n)return{start:n,end:e}},R=t=>r=>t(r)||{start:r.idx,end:r.idx},de=U(K),Y=U(oe),H=t=>r=>{if(t(r.raw[r.idx]))return{start:r.idx,end:r.idx+1}},ye=H(ie),E=t=>H(r=>r===t),V=H(t=>!K(t)),C=t=>{let r=[];for(let n=0;n<t.length;n++)r.push(E(t[n]));return m(...r)},m=(...t)=>r=>{let n=r.idx,e=0;for(let o=0;o<t.length;o++){let i=t[o](r);if(!i)return r.idx=n,null;r.idx+=i.end-i.start,e+=i.end-i.start}return r.idx=n,{start:r.idx,end:r.idx+e}},ce=t=>r=>{let n=r.idx,e=t(r);if(e)return r.idx+=e.end-e.start,{start:n,end:n}},L=(t,r)=>n=>{let e=t(n);if(e)return e.type=r,e.parser=t,n.tokens.push(e),n.idx=e.end,e},ue=t=>r=>{for(;r.raw[r.idx]!==void 0;)t(r)},S=(...t)=>r=>{for(let n=0;n<t.length;n++){let e=t[n](r);if(e)return e}},k=t=>r=>{let n=t(r);if(n)return{...n,end:n.start}},le=(t,r=1)=>n=>{let e=n.idx;if(n.idx=n.idx-r,!t(n)){n.idx=e;return}return n.idx=e,{start:e,end:e}},fe=()=>t=>({start:t.idx,end:t.idx+1}),Re=m(de,k(E("("))),Se=S(m(C("//"),R(U(t=>t!==`
`))),m(C("/*"),se(S(C("*/"),ae())),R(C("*/")))),pe=S(m(E('"'),R(U(t=>t!=='"')),E('"')),m(E("'"),R(U(t=>t!=="'")),E("'"))),ge=m(Y,R(E(".")),R(Y)),me=t=>t.idx===0?{start:0,end:0}:null,he=t=>t.idx===t.raw.length?{start:t.idx,end:t.idx}:null,J=t=>m(S(me,le(V)),C(t),k(S(he,V))),q=ue(S(L(pe,"STRING"),L(ge,"NUMBER"),L(J("null"),"KEYWORD"),L(J("undefined"),"KEYWORD"),ce(fe())));var M=class extends Array{},B="function";function F(t){return t instanceof M}var _=(t,r,...n)=>{let e=n.reduce((o,i)=>(Array.isArray(i)&&!F(i)?o.push(...i):o.push(i),o),[]);return new M(t,r||{},e)},O=(t,r="__r")=>{if(!F(t))return t;let[n,e,o]=t;e.key=e.key||r;let i=o.map((s,u)=>O(s,r+"c"+(s?.[1]?.key||u)));if(typeof n===B){let s=n({...e,children:i});return O(s,r+"e"+(s?.key||""))}return new M(n,e,i)},xe=(t,r)=>{let[,n]=t._hic||[];return Object.entries(r).forEach(([e,o])=>{if(n&&typeof n[e]===B&&t.removeEventListener(e,n[e]),typeof o===B)t.addEventListener(e.toLowerCase(),o);else{if(e==="value"||e==="disabled"){t[e]=o;return}let i=t;i.getAttribute(e)!==o&&i.setAttribute(e,o)}}),t},Te=(t,r)=>{for(let n=r.length-1;n>=0;n--){let e=r[n],o=r[n+1]||null,i=e.nextSibling;(o!==i||!t.contains(e))&&t?.insertBefore(e,o)}for(;t.childNodes.length>r.length;)t?.removeChild(t.childNodes[0]);return t},X=(t,r)=>{let n=r;if(!t&&t!=="")return null;if(!F(t))return r?.nodeType!==3?document.createTextNode(t):(r.textContent!==t&&(r.textContent=t),r);let[e,o]=r?._hic||[],[i,s]=t;if(e!==i||!n){let c=s.xmlns||(i==="svg"?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml");n=document.createElementNS(c,i)}xe(n,s),n._hic=t;let l=(F(t)?t[2]:[]).filter(c=>c).map((c,p)=>{let g=r?.childNodes[p];return X(c,g)});return Te(n,l),r!==n&&r?.parentNode?.replaceChild(n,r),typeof s.ref===B&&s.ref!==o?.ref&&s.ref(n,s.key),n};function G(t,r,n){var e=t.createShader(r);t.shaderSource(e,n),t.compileShader(e);var o=t.getShaderParameter(e,t.COMPILE_STATUS);if(o)return e;console.log(t.getShaderInfoLog(e)),t.deleteShader(e)}function j(t,r,n){var e=t.createProgram();t.attachShader(e,r),t.attachShader(e,n),t.linkProgram(e);var o=t.getProgramParameter(e,t.LINK_STATUS);if(o)return e;console.log(t.getProgramInfoLog(e)),t.deleteProgram(e)}function $(t,r=!0){let n=t.clientWidth,e=t.clientHeight,o=r?n*2:n,i=r?e*2:e,s=t.width!==o||t.height!==i;return s&&(t.width=o,t.height=i),s}function W(t,r){return[1,0,0,0,1,0,t,r,1]}function Z(t){let r=Math.cos(t),n=Math.sin(t);return[r,-n,0,n,r,0,0,0,1]}function Q(t,r){return[t,0,0,0,r,0,0,0,1]}function z(t,r){var n=t[0],e=t[0*3+1],o=t[0*3+2],i=t[1*3+0],s=t[1*3+1],u=t[1*3+2],l=t[2*3+0],c=t[2*3+1],p=t[2*3+2],g=r[0*3+0],A=r[0*3+1],f=r[0*3+2],h=r[1*3+0],v=r[1*3+1],b=r[1*3+2],w=r[2*3+0],y=r[2*3+1],d=r[2*3+2];return[g*n+A*i+f*l,g*e+A*s+f*c,g*o+A*u+f*p,h*n+v*i+b*l,h*e+v*s+b*c,h*o+v*u+b*p,w*n+y*i+d*l,w*e+y*s+d*c,w*o+y*u+d*p]}function D(t,r,n){return t*(1-n)+r*n}var _e=[0,0,100,0,0,100,100,0,100,100,0,100],ee=[50,50],Ae=({value:t})=>_("pre",{class:"editor_draw"},_("code",null,(()=>{let n=new P(t);return parseResult=q(n),n.tokens.length===0?[t]:n.tokens.reduce((e,o,i,s)=>{let l=s[i-1]?.end||0;o.start>l&&e.push(t.slice(l,o.start));let c=`parsed_${o.type}`,p=t.slice(o.start,o.end);return e.push(_("span",{class:c},p)),i===s.length-1&&e.push(t.slice(o.end)),e},[])})()));function ve(){let t=`#version 300 es

        in vec2 a_texcoord;
        in vec2 a_position;
        uniform vec2 u_resolution;
        uniform mat3 u_transform;

        out vec2 v_texcoord;

        void main() {
            vec2 position = (u_transform * vec3(a_position, 1)).xy;

            // convert the position from pixels to 0.0 to 1.0
            vec2 zeroToOne = position / u_resolution;

            // convert from 0->1 to 0->2
            vec2 zeroToTwo = zeroToOne * 2.0;

            vec2 clipSpace = zeroToTwo - 1.0;
            
            gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
            v_texcoord = a_texcoord;
        }
    `,r=`#version 300 es
        precision highp float;
        
        in vec2 v_texcoord;
        out vec4 outColor;
        uniform float u_brightness;
        uniform sampler2D u_texture;

        void main() {
            vec4 textureColor = texture(u_texture, v_texcoord);
            vec4 brightenedColor = textureColor + u_brightness * vec4(1.0, 1.0, 1.0, 0.0);
            outColor = vec4(brightenedColor.rgb, textureColor.a);
        }
    `,n=document.getElementById("example-timeline-ships"),e=n.getContext("webgl2");e||console.error("Failed to init webgl."),e.disable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND);let o=G(e,e.VERTEX_SHADER,t),i=G(e,e.FRAGMENT_SHADER,r),s=j(e,o,i),u=e.getAttribLocation(s,"a_position"),l=e.getUniformLocation(s,"u_resolution"),c=e.getUniformLocation(s,"u_brightness"),p=e.getUniformLocation(s,"u_transform"),g=e.getAttribLocation(s,"a_texcoord"),A=e.createVertexArray();e.bindVertexArray(A);{let d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,new Float32Array(_e),e.STATIC_DRAW),e.enableVertexAttribArray(u);let a=2,x=e.FLOAT,T=!1,I=0,N=0;e.vertexAttribPointer(u,a,x,T,I,N)}{let d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,.5,0,0,1,.5,0,.5,1,0,1]),e.STATIC_DRAW),e.enableVertexAttribArray(g);let a=2,x=e.FLOAT,T=!1,I=0,N=0;e.vertexAttribPointer(g,a,x,T,I,N)}{let d=e.createTexture();e.bindTexture(e.TEXTURE_2D,d),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));let a=new Image;a.src="resources/ship2.png",a.addEventListener("load",()=>{e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.generateMipmap(e.TEXTURE_2D)})}$(n,!0);let f={frameIdx:0,ship:{x:200,y:200,brightness:0,rotation:0,health:100}},h=[{x:200,y:200,health:100,rotation:0},{x:100,y:100,health:50,rotation:Math.PI}];function v(){let d=h.map((a,x)=>{let T=`opacity: ${x===f.frameIdx?1:.5};`;return _("div",{class:"timeline-row",style:T},_(Ae,{value:JSON.stringify(a)}))});X(O(_("div",{id:"timeline-controls"},d)),document.getElementById("timeline-controls"))}v();function b(){e.viewport(0,0,n.width,n.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(s),e.bindVertexArray(A),e.uniform2f(l,n.width,n.height);let{brightness:d,x:a,y:x,rotation:T}=f.ship,I=W(a,x),N=Z(T),te=Q(1,1),re=W(-ee[0],-ee[1]),ne=z(I,z(N,z(te,re)));e.uniform1f(c,d),e.uniformMatrix3fv(p,!1,ne),e.drawArrays(e.TRIANGLES,0,6)}function w(){let d=h[f.frameIdx],a=f.ship;a.x=D(a.x,d.x,.1),a.y=D(a.y,d.y,.1),a.health=D(a.health,d.health,.1),a.rotation=D(a.rotation,d.rotation,.1),a.health>d.health?a.brightness=1-d.health/a.health:a.brightness=0}let y=0;window.requestAnimationFrame(function d(a){a-y>1e3&&(f.frameIdx=(f.frameIdx+1)%h.length,y=a,v()),w(),b(),window.requestAnimationFrame(d)})}window.onload=function(){ve()};})();
