<html>
  <head>
    <title>What's dangerous about dangerouslySetInnerHtml?</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>

  <body>
    <h1>What's dangerous about dangerouslySetInnerHtml?</h1>


<p>I've been working on a side project in which I need to dynamically set the inner
HTML of a react component based on some text. To do this, I need to use React's
dangerouslySetInnerHTML attribute.</p>

<p>Interested in whether my usage of this attribute would be a cause for concern, I
researched what risks are involved in using it. Why is it dangerous?</p>

<p>React's
<a href="https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml">documentation on this attribute</a>
graciously lets us know that:</p>

<p class="quote">
setting HTML from code is risky because it's easy to inadvertently expose your
users to
a <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting</a>
(XSS) attack.
</p>

<p>So what exactly does this mean? And when is it safe to use?</p>

<p>When dangerouslySetInnerHTML is set on a React element, some content is
injected into the DOM. It's that content the determines whether or not you're in
danger of exposing your users to XSS attacks.</p>

<p>The main case that needs careful consideration is when that content can be
defined by a potentially malicious user.</p>

<h2>Dangerous case</h2>

<p>Consider for example a comment system. You may be tempted to allow users to
leave comments which include HTML tags to allow them to style their messages.
You could achieve this by storing their comment in a database, loading it any
time a user views the comment, and rendering it to the page via
dangerouslySetInnerHTML. This is dangerous because someone could leave a
comment which contains a script tag that reads things like session tokens and
passes them off to be abused. When some other user loads the page, fetches the
comment, and sets the inner HTML dangerously, the script tag will be placed onto
the page and executed.</p>

<p>If you still want to do something like this, then you'll need to look into
<a href="https://www.npmjs.com/package/sanitize-html">sanitising</a> your data first.

<h2>Safe case</h2>

<p>It's perfectly safe to use dangerouslySetInnerHTML when the content of the
HTML can't be set by an unknown third party. If, for example, you only use HTML
that is generated by your client, then you don't have to worry about XSS
attacks. Fortunately, this is what I'm using it for in my project.</p>

<h2>Note on naming</h2>

<p>This investigation also upholds the value of naming an attribute in this way.
Including "dangerous" in the attribute name itself set me on a path of education
which resulted in me being appropriately confident in the security of my users'
machines.</p>
