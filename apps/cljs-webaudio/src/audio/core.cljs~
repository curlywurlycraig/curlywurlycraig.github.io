(ns audio.core)

(enable-console-print!)

;; Create the context
(def ctx (new js/AudioContext))

;; Create source nodes
(def osc (.createOscillator ctx))
(set! (.-type osc) "triangle")

;; Create amplitude node
(def amp (.createGain ctx))
(set! (.. amp -gain -value) 0)

(defn trigger-amp
  [a]
  (set!
   (.. osc -frequency -value)
   (+ 110 (* (.random js/Math) 440)))
  (doto (.-gain a)
    (.cancelScheduledValues 0)
    (.setValueAtTime 1 (.-currentTime ctx))
    (.linearRampToValueAtTime 0 (+ (.-currentTime ctx) 2))))

;; Set up connections
(.. osc
    (connect amp)
    (connect (.-destination ctx)))

(.start osc)

(.addEventListener js/window "keydown" #(trigger-amp amp))

; (def random-button (. js/document getElementById "random"))
; (.addEventListener random-button "click" randomize)

